# eClipLint Configuration File
# Location: ~/.ecliplint/config.yaml (user) or config/config.yaml (project)

# ============================================================================
# Local Mode (Default - Privacy-First)
# ============================================================================
local:
  enabled: true
  backend: mlx-lm

  model:
    active: qwen25coder  # Default model for local repairs
    options:
      qwen25coder:
        repo: mlx-community/Qwen2.5-Coder-7B-Instruct-4bit
        max_tokens: 2048
        temperature: 0.1

      ministral:
        repo: alexgusevski/Ministral-3-8B-Instruct-2512-q4-mlx
        max_tokens: 2048
        temperature: 0.1

  generation:
    verbose: false
    stream: false  # Set to true for streaming output

  # Local prompts (existing)
  prompts:
    classify: |
      You are a classifier for clipboard text that may contain code, shell commands, and embedded code blocks.
      Return ONLY valid JSON with keys:
        kind: one of ["python","bash","rust","javascript","typescript","sql","json","yaml","markdown_fence","bash_python_heredoc","unknown"]
        inner_kind: same set or null
      Rules:
      - If you see a bash heredoc invoking python (python - <<'PY' ... PY), kind="bash_python_heredoc" and inner_kind="python".
      - If you see markdown fences like ```python ...```, kind="markdown_fence" and inner_kind=the fence language if present else "unknown".
      - Otherwise choose the best single kind.
      Text:
      <<<TEXT
      {text}
      TEXT

    repair_generic: |
      You are a code repair tool.

      Language: {language}

      Task:
      - Fix syntax errors, indentation, quoting, and trivial typos
      - Preserve intent and identifiers as much as possible
      - Do NOT add new functionality
      - Output ONLY valid {language} code
      - Do NOT include explanations, markdown, or extra text
      - Output must be parseable by a formatter

      Code:
      <<<CODE
      {code}
      CODE

# ============================================================================
# Cloud Mode (Optional - For Non-Proprietary Code)
# ============================================================================
cloud:
  # IMPORTANT: Cloud mode disabled by default
  # Only enable for NON-PROPRIETARY code
  enabled: false

  # Provider: OpenRouter (models updated weekly)
  provider: openrouter

  # API Key (use environment variable for security)
  # Get your API key: https://openrouter.ai/keys
  api_key_env: OPENROUTER_API_KEY  # Read from environment variable

  # Model Selection Strategy
  selection_strategy: complexity  # Options: complexity, manual, cost_optimized

  # Model Preferences (ordered by priority for complexity-based selection)
  models:
    # Complex code (high reasoning, multi-file, architecture)
    - id: anthropic/claude-4.5-sonnet:beta
      use_for: [complex_reasoning, multi_file, architecture]
      complexity_min: 0.6  # Use when complexity >= 0.6
      max_tokens: 8192
      temperature: 0.2
      enabled: true

    # Standard repairs (general purpose, quick fix)
    - id: openai/gpt-4o
      use_for: [standard_repair, quick_fix, general]
      complexity_min: 0.4  # Use when complexity >= 0.4
      max_tokens: 4096
      temperature: 0.1
      enabled: true

    # Code-specific (performance, optimization, simple repairs)
    - id: deepseek/deepseek-coder-v3
      use_for: [code_specific, performance, optimization, simple]
      complexity_min: 0.0  # Use for any complexity (fallback)
      max_tokens: 4096
      temperature: 0.1
      enabled: true

    # Reasoning and debugging
    - id: qwen/qwq-32b-preview
      use_for: [reasoning, debugging, logic_errors]
      complexity_min: 0.5
      max_tokens: 4096
      temperature: 0.2
      enabled: false  # Optional, enable if needed

  # Fallback Chain (if primary model fails)
  fallback_chain:
    - anthropic/claude-4.5-sonnet:beta
    - openai/gpt-4o
    - deepseek/deepseek-coder-v3

  # Timeout and Retry
  timeout_seconds: 60
  max_retries: 3
  retry_delay_seconds: 2

  # Cost Management
  cost_limits:
    warn_at_monthly_usd: 10.0   # Warn when monthly cost exceeds $10
    max_monthly_usd: 50.0        # Hard limit: stop when monthly cost exceeds $50
    max_per_repair_usd: 0.50     # Hard limit: reject repairs costing >$0.50

  # Usage Tracking
  usage_tracking:
    enabled: true
    storage_path: ~/.ecliplint/usage.jsonl

# ============================================================================
# Learning System (Cloud Mode Only)
# ============================================================================
learning:
  # Enable learning from successful repairs
  enabled: true

  # Pattern Extraction
  pattern_extraction:
    enabled: true
    min_confidence: 0.75  # Only learn from high-confidence repairs

  # Storage
  storage:
    path: ~/.ecliplint/learned_patterns/
    max_patterns_per_language: 1000  # LRU eviction when exceeded

  # Quality Metrics
  metrics:
    track_success_rate: true
    track_quality_score: true
    track_repair_time: true

  # Privacy and Security
  privacy:
    # Abstract code (store patterns, not actual code)
    abstract_code: true

    # Hash method for deduplication
    hash_method: sha256

    # Exclude patterns containing these (regex)
    exclude_patterns:
      - ".*password.*"
      - ".*secret.*"
      - ".*api[_-]?key.*"
      - ".*token.*"
      - "sk-[a-zA-Z0-9-]+"      # OpenAI/Anthropic keys
      - "ghp_[a-zA-Z0-9]+"       # GitHub tokens
      - ".*credentials?.*"
      - ".*auth.*"

  # Confidence Thresholds (VAMS-inspired)
  confidence_thresholds:
    high: 0.85      # Add to prompt immediately
    medium: 0.65    # Add after 3+ occurrences
    low: 0.45       # Monitor, don't use

# ============================================================================
# Hotkey Configuration
# ============================================================================
hotkeys:
  # Local mode (proprietary code)
  local:
    key: "cmd+shift+f"
    description: "Repair code locally (100% private)"

  # Cloud mode (non-proprietary code)
  cloud:
    key: "cmd+shift+g"
    description: "Repair code with cloud models (powerful + learning)"

# ============================================================================
# General Settings
# ============================================================================
general:
  # Default mode when no flag specified
  default_mode: local  # Options: local, cloud

  # Clipboard
  clipboard:
    timeout_seconds: 5
    max_size_bytes: 1048576  # 1 MB

  # Output
  output:
    show_diff: false  # Set to true to always show diff
    color: true       # Colorized output
    verbose: false    # Verbose logging

  # Cache
  cache:
    enabled: true
    formatter_cache: true  # Cache formatter results
    llm_cache: false       # Don't cache LLM results by default

# ============================================================================
# Language-Specific Settings
# ============================================================================
languages:
  python:
    formatter: black
    linter: ruff
    enable_type_checking: false

  javascript:
    formatter: prettier
    linter: eslint
    enable_type_checking: false

  typescript:
    formatter: prettier
    linter: eslint
    enable_type_checking: true

  rust:
    formatter: rustfmt
    linter: clippy

  sql:
    formatter: sqlfluff
    dialect: postgres  # Options: postgres, mysql, sqlite, etc.

  bash:
    formatter: shfmt
    linter: shellcheck

  yaml:
    formatter: prettier

  json:
    formatter: prettier

# ============================================================================
# Advanced Settings
# ============================================================================
advanced:
  # Parallel Processing
  parallel:
    enabled: false
    max_workers: 4

  # Experimental Features
  experimental:
    multi_file_repair: false
    explain_mode: false
    watch_mode: false

  # Debug
  debug:
    enabled: false
    log_file: ~/.ecliplint/debug.log
    log_level: INFO  # DEBUG, INFO, WARNING, ERROR
